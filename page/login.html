<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <link rel="stylesheet" href="../style/login.css" />
    <title>Login User | FILKOMreserV</title>
</head>

<body>
    <nav>
        <img class="logo" src="../assets/LOGO.png" alt="Logo FILKOMreserV" onclick="location.reload();" />

        <ul class="nav__links">
            <li class="link"><a href="../index.html">Beranda</a></li>
            <li class="link"><a href="../index.html#booklet">Buku Panduan</a></li>
            <li class="link"><a href="#footer">Kontak Kami</a></li>
            <li class="link" id="notificationLink" style="display: none">
                <a href="notifikasi.html" style="display: flex; align-items: center">
                    <i class="ri-notification-3-line" style="font-size: 1.5rem; margin-right: 5px"></i> Notifikasi
                </a>
            </li>
            <button id="loginButton" class="btn1" style="color: var(--white); background-color: var(--primary-color)">
        Login
      </button>
            <div id="userInfo" style="display: none">
                <span id="usernameDisplay" style="margin-right: 10px"></span>
                <button class="btn1" style="color: var(--white); background-color: var(--primary-color)" onclick="logout()">
          Logout
        </button>
            </div>
        </ul>
    </nav>

    <main class="section__container">
        <div class="login-container" id="loginContainer">
            <div class="login-card">
                <div class="login-header">
                    <h1>Login</h1>
                    <p>Silakan login untuk melanjutkan sebagai user</p>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Username atau Email</label>
                        <input type="username" id="username" name="username" class="form-control" placeholder="Masukkan username atau email Anda" required />
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" class="form-control" placeholder="Masukkan password Anda" required />
                    </div>
                    <button id="loginButton" type="submit" class="btn btn-primary btn-block">Login</button>
                </form>
                <div class="login-footer">
                    <p>Belum punya akun? Daftar di sini</p>
                    <p>Lupa Password?</p>
                </div>
            </div>
        </div>
        <p></p>
    </main>


    <footer class="footer" id="footer">
        <div class="section__container footer__container">
            <div class="footer__col">
                <h3>FILKOMreserV</h3>
                <p>
                    Sistem yang memudahkan mahasiswa dan dosen untuk memesan ruangan di Fakultas Ilmu Komputer.
                </p>
                <p>
                    Kemudahan akses, efisiensi waktu, dan transparansi adalah fokus utama kami.
                </p>
            </div>
            <div class="footer__col">
                <h4>Informasi Kontak</h4>
                <p>
                    Jl. Veteran, Ketawanggede, Lowokwaru, Kota Malang, Jawa Timur, Indonesia - 65145
                </p>
                <p>filkom@ub.ac.id</p>
                <p>+ 01 234 567 88</p>
                <p>+ 01 234 567 89</p>
            </div>
            <div class="footer__col">
                <h4>Legal</h4>
                <p>FAQ</p>
                <p>Syarat & Ketentuan</p>
                <p>Kebijakan Privasi</p>
            </div>
        </div>
        <div class="footer__bar">Copyright Â© 2024 FILKOMreserV.</div>
    </footer>

    <script>
        const loginContainer = document.getElementById("loginContainer");
        const loginButton = document.getElementById("loginButton");
        const userInfo = document.getElementById("userInfo");
        const notificationLink = document.getElementById("notificationLink");

        window.onload = function() {
            // Memeriksa status login saat halaman dimuat
            updateLoginStatus();
        };

        // Fungsi untuk memeriksa status login dan memperbarui tampilan
        function updateLoginStatus() {
            if (document.cookie.includes("Authorization")) {
                loginContainer.style.display = "none";
                loginButton.style.display = "none";
                userInfo.style.display = "flex";
                usernameDisplay.textContent = getCookie("username"); // Perbarui nama pengguna

                notificationLink.style.display = "block";
            } else {
                loginContainer.style.display = "block";
                loginButton.style.display = "inline-block";
                userInfo.style.display = "none";
                notificationLink.style.display = "none";
            }
        }

        document
            .getElementById("loginForm")
            .addEventListener("submit", async function(event) {
                event.preventDefault();
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                const response = await fetch("https://beaps-treamyracles-projects.vercel.app/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        username,
                        password
                    }),
                });

                // Setelah login berhasil
                if (response.ok) {
                    const data = await response.json();

                    // Menyimpan token dan username ke dalam cookie
                    document.cookie = `Authorization=${data.token}; path=/;`;
                    document.cookie = `Username=${data.username}; path=/;`;

                    // Memperbarui status login
                    updateLoginStatus();

                    // Mengarahkan pengguna ke halaman index.html
                    window.location.href = "../index.html";
                } else {
                    alert("Login gagal! Periksa kembali username dan password Anda.");
                }
            });

        async function logout() {
            const response = await fetch("https://beaps-treamyracles-projects.vercel.app/logout", {
                method: "POST",
            });
            if (response.ok) {
                // Hapus cookie dengan path yang sama dengan path tempat cookie dibuat
                document.cookie =
                    "Authorization=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
                document.cookie =
                    "Username=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";

                // Memperbarui status tampilan setelah logout
                updateLoginStatus(); // Memperbarui tampilan tanpa memuat ulang halaman
                window.location.href = "../index.html"; // Arahkan kembali ke halaman beranda setelah logout
            }
        }

        function getCookie(name) {
            // Membuat regex untuk mencocokkan cookie berdasarkan nama
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        // Toggle login form visibility
        function toggleLoginForm() {
            loginContainer.style.display =
                loginContainer.style.display === "none" ? "block" : "none";
        }
    </script>
</body>

</html>